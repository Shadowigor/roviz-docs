<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>roviz: Plugin System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">roviz
   &#160;<span id="projectnumber">0.7</span>
   </div>
   <div id="projectbrief">Code Documentation of roviz</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugin System </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>First we need to differentiate between two terms:</p>
<ul>
<li>Plugin Container: A shared library (dll,so,dylib) which will be loaded at runtime and can be enabled/disabled by the user.</li>
<li>Plugin Component: A exported Class which implements a certain interface. Plugin components are bundled in a Plugin Container.</li>
</ul>
<p>Each Plugin-Container is a own qmake project, and it will link against the itemframework and your usercore. Each Plugin-Container must provide a factory (sublass of <code><a class="el" href="classInterfaceFactory.html" title="The plugin factory interface. You need to have one factory per plugin container. ">InterfaceFactory</a></code>), where it registers all to be exported classes. Each Plugin-Component must be QObject-derived and should implement a certain Interface.</p>
<h2>Protocol Analyzer Example</h2>
<p>Let's say you build a protocol analyzer application. And you want to allow implemention of custom protocols by using the Plugin System.</p>
<p>You have an interface header file (e.g in your usercore):</p>
<div class="fragment"><div class="line">class InterfaceProtocol {</div><div class="line">   public:</div><div class="line">     virtual const QString&amp; protocolName() const = 0;</div><div class="line">     virtual void process(const&amp; QByteArray) = 0;</div><div class="line">     //......</div><div class="line">}</div><div class="line">Q_DECLARE_INTERFACE(InterfaceProtocol,&quot;org.mycompany.myapp.InterfaceProtocol&quot;)</div></div><!-- fragment --><p>Lets look at how a Plugin-Container containing a Tcp &amp; Udp Protocol implementation would look like.</p>
<p>Your <code>tcpprotocol.h</code> (e.g. inside of the plugins/layer4 folder) would typically look like this:</p>
<div class="fragment"><div class="line">class TcpProtocol: public QObject, public InterfaceProtocol {</div><div class="line">    Q_OBJECT</div><div class="line">    Q_INTERFACES(InterfaceProtocol)</div><div class="line">    public:</div><div class="line">      const QString&amp; protocolName() const override;</div><div class="line">      void process(const&amp; QByteArray) override;</div><div class="line">      //......</div><div class="line">}</div></div><!-- fragment --><p>Then your Plugin-Component Factory would look like this:</p>
<p><code>layer4factory.h</code> (e.g. also inside the plugins/layer4 folder)</p>
<div class="fragment"><div class="line">#include &quot;plugin/interface_factory.h&quot;</div><div class="line">class Layer4Factory : public InterfaceFactory</div><div class="line">{</div><div class="line">    Q_OBJECT</div><div class="line">    Q_PLUGIN_METADATA(IID &quot;Layer4Factory&quot; FILE &quot;layer4.json&quot;)</div><div class="line">    Q_INTERFACES(InterfaceFactory)</div><div class="line">public:</div><div class="line">    Layer4Factory();</div><div class="line"></div><div class="line">public:</div><div class="line">    bool init();</div><div class="line">};</div></div><!-- fragment --><p><code>layer4factory.cpp</code> (e.g. also inside the plugins/layer4 folder)</p>
<div class="fragment"><div class="line">#include &quot;layer4factory.h&quot;</div><div class="line">#include &quot;plugin/plugin_manager.h&quot;</div><div class="line">#include &quot;tcpprotocol.h&quot;</div><div class="line">#include &quot;udpprotocol.h&quot;</div><div class="line"></div><div class="line">Layer4Factory::Layer4Factory()</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line">bool Layer4Factory::init()</div><div class="line">{</div><div class="line">    PluginManager::instance()-&gt;addPluginComponent&lt;TcpProtocol, InterfaceProtocol&gt;();</div><div class="line">    PluginManager::instance()-&gt;addPluginComponent&lt;UdpProtocol, InterfaceProtocol&gt;();</div><div class="line">    return true;</div><div class="line">}</div></div><!-- fragment --><p>That's it. Build your plugin, make sure it's placed in the correct plugin directory and it should be loaded by the PluginLoader.</p>
<p>Later in your programm, there are two ways of instantiating your plugins:</p>
<div class="fragment"><div class="line">// Create an instance of a specific plugin component:</div><div class="line">InterfaceProtocol* tcpProto = PluginManager::instance()-&gt;createInstance&lt;InterfaceProtocol&gt;(&quot;TcpProtocol&quot;);</div><div class="line"></div><div class="line">// Create instances of all plugin components that implement a certain interface:</div><div class="line">QVector&lt;InterfaceProtocol*&gt; myProtos = PluginManager::instance()-&gt;createInstances&lt;InterfaceProtocol&gt;();</div><div class="line"></div><div class="line">// ...</div><div class="line"></div><div class="line">// Don&#39;t forget to destroy the instances when you no longer need them.</div><div class="line">delete tcpProto;</div><div class="line">qDeleteAll(myProtos);</div></div><!-- fragment --><p>Note: It's also possible to let your plugin components directly intherit from a class which is QObject derived (instead of using <code>Q_INTERFACES</code> as shown above). For example: Just create a class which inherits from <code><a class="el" href="classAbstractItem.html" title="The AbstractItem class is the base class for all items. ">AbstractItem</a></code> and register it in your factory, and your item will appear in the Item-Toolbox. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Sep 12 2017 15:13:49 for roviz by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
